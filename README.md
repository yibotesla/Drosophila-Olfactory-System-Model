# æœè‡å—…è§‰ç³»ç»Ÿè®¡ç®—æ¨¡å‹ (Drosophila Olfactory System Model)

ä¸€ä¸ªåŸºäºç”Ÿç‰©å­¦åŸç†çš„æœè‡å—…è§‰ç¥ç»å›è·¯è®¡ç®—æ¨¡å‹ï¼Œæ¨¡æ‹Ÿä»æ„ŸçŸ¥ä¿¡æ¯ç¼–ç åˆ°è¡Œä¸ºå†³ç­–è¾“å‡ºçš„å®Œæ•´ç¥ç»å›è·¯ã€‚

Group membersï¼š Yibo Yu, Yuyuan Lu, Jiahao Tang, Zhouhang Tao

## é¡¹ç›®æ¦‚è¿°

æœ¬æ¨¡å‹å®ç°äº†æœè‡å—…è§‰ç³»ç»Ÿçš„ä¸‰å±‚å‰é¦ˆç½‘ç»œæ¶æ„ï¼š
- **è§¦è§’å¶ (AL)** â†’ **è˜‘è‡ä½“ (MB)** â†’ **è¾“å‡ºç¥ç»å…ƒ (MBONs)**

å¹¶å¼•å…¥è°ƒåˆ¶ç¥ç»å…ƒï¼ˆå¤šå·´èƒºç¥ç»å…ƒ DANsï¼‰å®ç°è”æƒ³å­¦ä¹ ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ§  **ç¨€ç–ç¼–ç **: é€šè¿‡ k-Winner-Take-All (kWTA) æœºåˆ¶å®ç° KC å±‚çº¦ 5% çš„ç¨€ç–æ¿€æ´»
- ğŸ”€ **æ¨¡å¼åˆ†ç¦»**: å°†ç›¸ä¼¼è¾“å…¥æ˜ å°„åˆ°ä¸åŒçš„ç¨€ç–è¡¨å¾
- ğŸ“š **ä¹˜æ³•å­¦ä¹ è§„åˆ™**: æ›´ç¬¦åˆç”Ÿç‰©å­¦çš„æƒé‡æ›´æ–°è§„åˆ™ï¼Œæƒé‡æ¥è¿‘è¾¹ç•Œæ—¶è‡ªç„¶å‡é€Ÿ
- ğŸ¯ **å¤š MBON æ”¯æŒ**: æ”¯æŒå¤šä¸ªè¾“å‡ºç¥ç»å…ƒï¼Œæ¨¡æ‹Ÿæ›´å¤æ‚çš„è¡Œä¸ºå†³ç­–
- ğŸ“Š **å­¦ä¹ å†å²è®°å½•**: å®Œæ•´è¿½è¸ªè®­ç»ƒè¿‡ç¨‹ï¼Œæ”¯æŒå­¦ä¹ æ›²çº¿åˆ†æ
- âš™ï¸ **é…ç½®ç®¡ç†**: ä½¿ç”¨ ModelConfig æ•°æ®ç±»ç®¡ç†è¶…å‚æ•°
- ğŸ”’ **è¾“å…¥éªŒè¯**: å®Œå–„çš„è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†
- ğŸ’¾ **åºåˆ—åŒ–æ”¯æŒ**: å®Œæ•´çš„ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–åŠŸèƒ½ï¼ŒåŒ…å«ç§å­å’Œå­¦ä¹ å†å²
- ğŸ² **ç‹¬ç«‹éšæœºçŠ¶æ€**: ä½¿ç”¨ numpy.random.Generator é¿å…å…¨å±€çŠ¶æ€æ±¡æŸ“

## æ¨¡å‹å¯è§†åŒ–

### åŸºç¡€æ¨¡å‹å¯è§†åŒ–

![æ¨¡å‹å¯è§†åŒ–ç»“æœ](model_visualization.png)

ä¸Šå›¾å±•ç¤ºäº†æ¨¡å‹çš„9ä¸ªå…³é”®ç‰¹æ€§ï¼š
1. **æ°”å‘³è¾“å…¥å‘é‡** - 50ç»´æ¿€æ´»æ¨¡å¼
2. **KCç¨€ç–æ¿€æ´»** - ä»…5%ç¥ç»å…ƒæ¿€æ´»
3. **æ¨¡å¼åˆ†ç¦»æ•ˆæœ** - KCè·ç¦» > è¾“å…¥è·ç¦»
4. **å­¦ä¹ æ›²çº¿** - åŒæ¶è®­ç»ƒé™ä½å“åº”
5. **æƒé‡åˆ†å¸ƒå˜åŒ–** - è®­ç»ƒå‰åå¯¹æ¯”
6. **å­¦ä¹ ç‰¹å¼‚æ€§** - ä»…è®­ç»ƒæ°”å‘³å—å½±å“
7. **PN-KCè¿æ¥çŸ©é˜µ** - å›ºå®šç¨€ç–è¿æ¥
8. **KC-MBONæƒé‡çƒ­å›¾** - å¯å¡‘æ€§æƒé‡
9. **æ³›åŒ–èƒ½åŠ›** - å¯¹å™ªå£°å˜ä½“çš„å“åº”

### ä¹˜æ³•å­¦ä¹ è§„åˆ™

![ä¹˜æ³•å­¦ä¹ è§„åˆ™](multiplicative_learning.png)

å±•ç¤ºäº†æ”¹è¿›åçš„ä¹˜æ³•å­¦ä¹ è§„åˆ™ç‰¹æ€§ï¼š
1. **LTD ä¹˜æ³•è§„åˆ™**: `w = w Ã— (1 - Î· Ã— R)` - æƒé‡æŒ‰æ¯”ä¾‹è¡°å‡
2. **LTP ä¹˜æ³•è§„åˆ™**: `w = w + Î· Ã— |R| Ã— (1 - w)` - æƒé‡å‘1å¢é•¿
3. **è¾¹ç•Œå‡é€Ÿæ•ˆæœ** - æƒé‡æ¥è¿‘è¾¹ç•Œæ—¶æ›´æ–°å¹…åº¦è‡ªç„¶å‡å°
4. **ä¸åŠ æ³•è§„åˆ™å¯¹æ¯”** - ä¹˜æ³•è§„åˆ™æ›´å¹³æ»‘ï¼Œé¿å…æƒé‡å¿«é€Ÿé¥±å’Œ

### å­¦ä¹ å†å²è®°å½•

![å­¦ä¹ å†å²](learning_history.png)

å±•ç¤ºäº†å­¦ä¹ å†å²è¿½è¸ªåŠŸèƒ½ï¼š
1. **è®­ç»ƒäº‹ä»¶æ—¶é—´çº¿** - è®°å½•æ¯æ¬¡è®­ç»ƒçš„æƒé‡å˜åŒ–
2. **æŒ‰æ°”å‘³åˆ†ç»„ç»Ÿè®¡** - ä¸åŒæ°”å‘³çš„è®­ç»ƒæ¬¡æ•°
3. **ç´¯ç§¯æƒé‡å˜åŒ–** - å­¦ä¹ è¿‡ç¨‹çš„æ•´ä½“è¶‹åŠ¿
4. **è®­ç»ƒå¼ºåº¦åˆ†å¸ƒ** - åŒæ¶/å¥–åŠ±è®­ç»ƒçš„å¼ºåº¦åˆ†å¸ƒ

### å¤š MBON æ”¯æŒ

![å¤šMBONæ”¯æŒ](multi_mbon.png)

å±•ç¤ºäº†å¤šè¾“å‡ºç¥ç»å…ƒæ”¯æŒï¼š
1. **å¤šMBONæƒé‡çŸ©é˜µ** - æ¯ä¸ªMBONæœ‰ç‹¬ç«‹çš„æƒé‡
2. **å„MBONå“åº”å¯¹æ¯”** - ä¸åŒMBONå¯¹åŒä¸€æ°”å‘³çš„å“åº”
3. **åŒºåˆ†æŒ‡æ•°** - è®­ç»ƒåå„MBONçš„å­¦ä¹ æ•ˆæœ
4. **æ³›åŒ–å“åº”** - å¤šMBONå¯¹å™ªå£°å˜ä½“çš„å“åº”

### é…ç½®ä¸éªŒè¯

![é…ç½®å’ŒéªŒè¯](config_validation.png)

å±•ç¤ºäº†é…ç½®ç®¡ç†å’Œè¾“å…¥éªŒè¯ï¼š
1. **å­¦ä¹ ç‡æ•ˆæœ** - ä¸åŒé…ç½®ä¸‹çš„å­¦ä¹ æ›²çº¿
2. **ç¨€ç–åº¦è®¾ç½®** - ä¸åŒç¨€ç–åº¦çš„KCæ¿€æ´»æ•°é‡
3. **ç§å­å¯é‡ç°æ€§** - ç›¸åŒç§å­äº§ç”Ÿç›¸åŒç»“æœ
4. **è¾“å…¥éªŒè¯** - å„ç§æ— æ•ˆè¾“å…¥çš„æ‹’ç»

è¿è¡Œ `python visualize.py` å¯é‡æ–°ç”Ÿæˆæ‰€æœ‰å¯è§†åŒ–å›¾è¡¨ã€‚

## æ¨¡å‹éªŒè¯ç»“æœ

è¿è¡Œ `python analyze_model.py` å¯æ‰§è¡Œå®Œæ•´çš„æ¨¡å‹éªŒè¯åˆ†æã€‚

### ğŸ‰ æ¨¡å‹å®Œå…¨è¾¾åˆ°è®¾è®¡ç›®çš„

| è®¾è®¡ç›®æ ‡ | çŠ¶æ€ | å…³é”®æ•°æ® | ç”Ÿç‰©å­¦æ„ä¹‰ |
|----------|------|----------|------------|
| **ç¨€ç–ç¼–ç ** | âœ… é€šè¿‡ | ç²¾ç¡®æ¿€æ´» 100/2000 KC (5.0%) | ç¬¦åˆæœè‡è˜‘è‡ä½“çº¦ 5% çš„ç¨€ç–æ¿€æ´»è§‚å¯Ÿ |
| **æ¨¡å¼åˆ†ç¦»** | âœ… é€šè¿‡ | é‡å åº¦ä» 97.8% é™è‡³ 67.9%ï¼Œé™ä½ 30.6% | KC å±‚æœ‰æ•ˆæ”¾å¤§è¾“å…¥å·®å¼‚ï¼Œæé«˜è¾¨åˆ«èƒ½åŠ› |
| **è”æƒ³å­¦ä¹ ** | âœ… é€šè¿‡ | è®­ç»ƒæ°”å‘³å“åº”ä» 100 é™è‡³ 59 (åŒºåˆ†æŒ‡æ•° 0.41) | åŒæ¶å­¦ä¹ å¯¼è‡´å›é¿è¡Œä¸º |
| **å­¦ä¹ ç‰¹å¼‚æ€§** | âœ… é€šè¿‡ | æœªè®­ç»ƒæ°”å‘³ä»…å˜åŒ– 4.91% | å­¦ä¹ é«˜åº¦ç‰¹å¼‚äºè®­ç»ƒæ°”å‘³ |
| **ä¹˜æ³•å­¦ä¹ è§„åˆ™** | âœ… é€šè¿‡ | è¾¹ç•Œå‡é€Ÿæ¯” 4.86x | æƒé‡æ¥è¿‘è¾¹ç•Œæ—¶æ›´æ–°è‡ªç„¶å‡é€Ÿ |
| **å­¦ä¹ å†å²è®°å½•** | âœ… é€šè¿‡ | å®Œæ•´è®°å½•æ‰€æœ‰è®­ç»ƒäº‹ä»¶ | æ”¯æŒå­¦ä¹ æ›²çº¿åˆ†æ |
| **æ³›åŒ–èƒ½åŠ›** | âœ… é€šè¿‡ | å™ªå£°å¢åŠ æ—¶å“åº”å¹³æ»‘æ¢å¤ | ç¬¦åˆç”Ÿç‰©å­¦æ³›åŒ–æ¢¯åº¦ |
| **åºåˆ—åŒ–å¾€è¿”** | âœ… é€šè¿‡ | æƒé‡ã€å“åº”ã€å†å²å®Œå…¨ä¸€è‡´ | æ”¯æŒå®éªŒå¤ç° |

### è¯¦ç»†éªŒè¯æ•°æ®

#### 1. ç¨€ç–ç¼–ç  (Sparse Coding)

```
KC æ€»æ•°: 2000
è®¾å®šç¨€ç–åº¦: 5.0%
å®é™…æ¿€æ´» KC æ•°: 100
å®é™…ç¨€ç–åº¦: 5.00%
```

kWTA æœºåˆ¶ç²¾ç¡®æ§åˆ¶ KC å±‚çš„ç¨€ç–æ¿€æ´»ï¼Œç¬¦åˆæœè‡è˜‘è‡ä½“çš„ç”Ÿç‰©å­¦è§‚å¯Ÿã€‚ç¨€ç–ç¼–ç æ˜¯è˜‘è‡ä½“çš„æ ¸å¿ƒè®¡ç®—ç‰¹æ€§ï¼Œæœ‰åŠ©äºæé«˜å­˜å‚¨å®¹é‡å’Œæ¨¡å¼åˆ†ç¦»èƒ½åŠ›ã€‚

#### 2. æ¨¡å¼åˆ†ç¦» (Pattern Separation)

```
æµ‹è¯•æ ·æœ¬: 20 å¯¹ç›¸ä¼¼æ°”å‘³ (90% ç›¸ä¼¼)
å¹³å‡è¾“å…¥é‡å åº¦: 0.9778 (97.8%)
å¹³å‡ KC é‡å åº¦: 0.6790 (67.9%)
é‡å åº¦é™ä½: 30.6%
å¹³å‡åˆ†ç¦»æ¯”: 10.58
```

ç›¸ä¼¼çš„è¾“å…¥æ°”å‘³åœ¨ KC å±‚è¢«æ˜ å°„ä¸ºæ›´ä¸åŒçš„ç¨€ç–è¡¨å¾ã€‚åˆ†ç¦»æ¯” > 1 è¡¨æ˜ KC å±‚æœ‰æ•ˆæ”¾å¤§äº†è¾“å…¥å·®å¼‚ï¼Œè¿™æ˜¯è˜‘è‡ä½“æ”¯æŒç²¾ç»†æ°”å‘³è¾¨åˆ«çš„å…³é”®æœºåˆ¶ã€‚

#### 3. è”æƒ³å­¦ä¹  (Associative Learning)

```
è®­ç»ƒå‰å“åº”:
  - æ°”å‘³ A: 100.0000
  - æ°”å‘³ B: 100.0000

åŒæ¶è®­ç»ƒå (æ°”å‘³ A, 5æ¬¡):
  - æ°”å‘³ A: 59.0490 (å˜åŒ–: -40.95)
  - æ°”å‘³ B: 95.0859 (å˜åŒ–: -4.91)

åŒºåˆ†æŒ‡æ•°:
  - æ°”å‘³ A (è®­ç»ƒ): 0.4095
  - æ°”å‘³ B (æœªè®­ç»ƒ): 0.0491
```

åŒæ¶è®­ç»ƒæ˜¾è‘—é™ä½äº†è®­ç»ƒæ°”å‘³çš„ MBON å“åº”ï¼ˆé™ä½ 41%ï¼‰ï¼Œè€Œæœªè®­ç»ƒæ°”å‘³å‡ ä¹ä¸å—å½±å“ï¼ˆä»…å˜åŒ– 4.9%ï¼‰ã€‚è¿™ç¬¦åˆä¸‰å› ç´ å­¦ä¹ å¾‹çš„é¢„æœŸï¼šåªæœ‰åŒæ—¶æ»¡è¶³çªè§¦å‰æ´»æ€§ï¼ˆKC æ¿€æ´»ï¼‰ã€çªè§¦åæ´»æ€§ï¼ˆMBONï¼‰å’Œè°ƒåˆ¶ä¿¡å·ï¼ˆå¤šå·´èƒºï¼‰çš„çªè§¦æ‰ä¼šè¢«ä¿®æ”¹ã€‚

#### 4. ä¹˜æ³•å­¦ä¹ è§„åˆ™ (Multiplicative Learning)

```
å‰5æ¬¡è®­ç»ƒå¹³å‡æƒé‡å˜åŒ–: 0.004095
å5æ¬¡è®­ç»ƒå¹³å‡æƒé‡å˜åŒ–: 0.000843
å˜åŒ–å‡é€Ÿæ¯”: 4.86x
```

ä¹˜æ³•å­¦ä¹ è§„åˆ™çš„å…³é”®ç‰¹æ€§æ˜¯æƒé‡æ¥è¿‘è¾¹ç•Œæ—¶æ›´æ–°å¹…åº¦è‡ªç„¶å‡å°ã€‚è¿™é¿å…äº†æƒé‡å¿«é€Ÿé¥±å’Œï¼Œæ›´ç¬¦åˆç”Ÿç‰©å­¦ä¸­çªè§¦å¯å¡‘æ€§çš„åŠ¨æ€èŒƒå›´ç‰¹æ€§ã€‚

#### 5. æ³›åŒ–èƒ½åŠ› (Generalization)

```
å™ªå£°æ°´å¹³ -> å¹³å‡å“åº”:
  0.0: 59.05 (è®­ç»ƒæ°”å‘³)
  0.1: 72.07
  0.2: 80.71
  0.3: 87.14
  0.4: 90.29
  0.5: 92.22
```

æ¨¡å‹å±•ç¤ºäº†å¹³æ»‘çš„æ³›åŒ–æ¢¯åº¦ï¼šéšç€å™ªå£°å¢åŠ ï¼ˆæ°”å‘³ä¸è®­ç»ƒæ°”å‘³çš„å·®å¼‚å¢å¤§ï¼‰ï¼ŒMBON å“åº”é€æ¸æ¢å¤åˆ°æœªè®­ç»ƒæ°´å¹³ã€‚è¿™ç¬¦åˆç”Ÿç‰©å­¦ä¸­è§‚å¯Ÿåˆ°çš„æ³›åŒ–ç°è±¡ã€‚

### ç”Ÿç‰©å­¦æ„ä¹‰æ€»ç»“

æœ¬æ¨¡å‹æˆåŠŸæ¨¡æ‹Ÿäº†æœè‡å—…è§‰ç³»ç»Ÿçš„æ ¸å¿ƒè®¡ç®—åŸç†ï¼š

1. **ç¨€ç–ç¼–ç ** - è˜‘è‡ä½“ KC å±‚çš„ç¨€ç–æ¿€æ´»æ¨¡å¼ï¼Œæé«˜å­˜å‚¨å®¹é‡
2. **æ¨¡å¼åˆ†ç¦»** - å°†ç›¸ä¼¼è¾“å…¥æ˜ å°„ä¸ºæ›´ä¸åŒçš„è¡¨å¾ï¼Œæ”¯æŒç²¾ç»†è¾¨åˆ«
3. **è”æƒ³å­¦ä¹ ** - é€šè¿‡å¤šå·´èƒºè°ƒåˆ¶å®ç°æ°”å‘³-å¥–æƒ©å…³è”
4. **å­¦ä¹ ç‰¹å¼‚æ€§** - å­¦ä¹ é«˜åº¦ç‰¹å¼‚äºè®­ç»ƒåˆºæ¿€
5. **æ³›åŒ–æ¢¯åº¦** - å¯¹ç›¸ä¼¼åˆºæ¿€äº§ç”Ÿé€‚åº¦æ³›åŒ–

## å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd drosophila-olfactory-model

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### ä¾èµ–é¡¹

- numpy >= 1.21.0
- matplotlib >= 3.5.0 (ç”¨äºå¯è§†åŒ–)
- hypothesis >= 6.0.0 (ç”¨äºå±æ€§æµ‹è¯•)
- pytest >= 7.0.0 (ç”¨äºå•å…ƒæµ‹è¯•)

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/                          # æºä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ model.py                  # ä¸»æ¨¡å‹ç±» DrosophilaOlfactoryModel
â”‚   â”œâ”€â”€ sparse_encoder.py         # ç¨€ç–ç¼–ç å™¨ (KCå±‚)
â”‚   â”œâ”€â”€ odor_dataset.py           # æ°”å‘³æ•°æ®é›†ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ evaluator.py              # æ¨¡å‹è¯„ä¼°å™¨
â”‚   â””â”€â”€ config.py                 # é…ç½®ç®¡ç† ModelConfig
â”œâ”€â”€ tests/                        # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py               # å…±äº«æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ test_properties.py        # å±æ€§æµ‹è¯• (Property-Based Testing)
â”‚   â”œâ”€â”€ test_evaluator.py         # è¯„ä¼°å™¨å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ test_config.py            # é…ç½®ç±»æµ‹è¯•
â”œâ”€â”€ visualize.py                  # å¯è§†åŒ–è„šæœ¬
â”œâ”€â”€ example.py                    # ç¤ºä¾‹è„šæœ¬
â”œâ”€â”€ requirements.txt              # Python ä¾èµ–
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
import numpy as np
from src.model import DrosophilaOlfactoryModel
from src.odor_dataset import OdorDataset

# åˆ›å»ºæ¨¡å‹
model = DrosophilaOlfactoryModel(
    n_pn=50,           # æŠ•å°„ç¥ç»å…ƒæ•°é‡
    n_kc=2000,         # Kenyon ç»†èƒæ•°é‡
    n_mbon=1,          # è¾“å‡ºç¥ç»å…ƒæ•°é‡
    sparsity=0.05,     # KC å±‚ç¨€ç–åº¦ (5%)
    learning_rate=0.05,# å­¦ä¹ ç‡
    seed=42            # éšæœºç§å­ (å¯é€‰)
)

# ç”Ÿæˆæ°”å‘³æ•°æ®
dataset = OdorDataset(n_features=50)
odor_a = dataset.generate_prototype("odor_A", seed=42)

# é¢„æµ‹ MBON è¾“å‡º
output_before, kc_activation = model.predict(odor_a)
print(f"è®­ç»ƒå‰ MBON è¾“å‡º: {output_before[0]:.4f}")

# æ‰§è¡ŒåŒæ¶å­¦ä¹ 
model.train_aversive(odor_a, strength=1.0)

# å†æ¬¡é¢„æµ‹
output_after, _ = model.predict(odor_a)
print(f"è®­ç»ƒå MBON è¾“å‡º: {output_after[0]:.4f}")
```

### ä½¿ç”¨é…ç½®ç±»

```python
from src.config import ModelConfig
from src.model import DrosophilaOlfactoryModel

# åˆ›å»ºé…ç½®
config = ModelConfig(
    n_pn=50,
    n_kc=2000,
    n_mbon=3,          # å¤šMBON
    sparsity=0.05,
    learning_rate=0.1,
    connectivity=0.14,
    seed=42
)

# éªŒè¯é…ç½®
config.validate()

# ä»é…ç½®åˆ›å»ºæ¨¡å‹
model = DrosophilaOlfactoryModel.from_config(config)
```

### å­¦ä¹ å†å²è¿½è¸ª

```python
# æ‰§è¡Œå¤šæ¬¡è®­ç»ƒ
for i in range(5):
    model.train_aversive(odor_a, strength=1.0)

# è·å–å­¦ä¹ å†å²
history = model.get_learning_history()
for event in history:
    print(f"ç±»å‹: {event['type']}, å¼ºåº¦: {event['strength']}, "
          f"æƒé‡å˜åŒ–: {event['weight_change']:.4f}")

# é‡ç½®æƒé‡ (å¯é€‰æ‹©æ˜¯å¦æ¸…é™¤å†å²)
model.reset_weights(clear_history=True)
```

### æ¨¡å‹åºåˆ—åŒ–

```python
# ä¿å­˜æ¨¡å‹ (åŒ…å«ç§å­å’Œå­¦ä¹ å†å²)
json_str = model.to_json()
with open("model_state.json", "w") as f:
    f.write(json_str)

# åŠ è½½æ¨¡å‹
with open("model_state.json", "r") as f:
    json_str = f.read()
restored_model = DrosophilaOlfactoryModel.from_json(json_str)

# éªŒè¯æ¢å¤åçš„å­¦ä¹ å†å²
print(f"æ¢å¤çš„å­¦ä¹ å†å²: {len(restored_model.get_learning_history())} æ¡è®°å½•")
```

### æ¨¡å‹è¯„ä¼°

```python
from src.evaluator import ModelEvaluator

evaluator = ModelEvaluator(model)

# è®¡ç®—åŒºåˆ†æŒ‡æ•° (æ”¯æŒæŒ‡å®šMBON)
di = evaluator.compute_discrimination_index(
    response_before=output_before,
    response_after=output_after,
    mbon_idx=0  # æŒ‡å®šMBONç´¢å¼•
)
print(f"åŒºåˆ†æŒ‡æ•°: {di:.4f}")

# è®¡ç®—æ¨¡å¼åˆ†ç¦»æ•ˆæœ
odor_b = dataset.generate_prototype("odor_B", seed=43)
separation = evaluator.compute_pattern_separation(odor_a, odor_b)
print(f"æ¨¡å¼åˆ†ç¦»æ¯”: {separation['separation_ratio']:.4f}")

# è¯„ä¼°æ³›åŒ–èƒ½åŠ› (è¿”å›æ‰€æœ‰MBONå“åº”)
variants = dataset.generate_variants(odor_a, n_samples=10, noise_level=0.1)
responses = evaluator.evaluate_generalization(odor_a, variants)
print(f"æ³›åŒ–å“åº”å½¢çŠ¶: {responses.shape}")  # (n_variants, n_mbon)
```

## æ¨¡å‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ°”å‘³è¾“å…¥ (Odor Input)                      â”‚
â”‚                         N=50 ç»´å‘é‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æŠ•å°„ç¥ç»å…ƒå±‚ (PN Layer)                        â”‚
â”‚                         50 ä¸ªç¥ç»å…ƒ                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    W_PN_KC (å›ºå®šéšæœºè¿æ¥)
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Kenyon ç»†èƒå±‚ (KC Layer)                       â”‚
â”‚              ~2000 ä¸ªç¥ç»å…ƒ, 5% ç¨€ç–æ¿€æ´» (kWTA)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    W_KC_MBON (å¯å¡‘æ€§è¿æ¥)
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¾“å‡ºç¥ç»å…ƒ (MBON)                             â”‚
â”‚                 1-N ä¸ªç¥ç»å…ƒ, è¡Œä¸ºå†³ç­–è¾“å‡º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â–²
                                â”‚
                    è°ƒåˆ¶ä¿¡å· (å¤šå·´èƒºç¥ç»å…ƒ DANs)
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éæ¡ä»¶åˆºæ¿€ (US)                               â”‚
â”‚                   å¥–åŠ± / æƒ©ç½šä¿¡å·                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å­¦ä¹ æœºåˆ¶

### ä¹˜æ³•å­¦ä¹ è§„åˆ™ (æ”¹è¿›ç‰ˆ)

ç›¸æ¯”ä¼ ç»Ÿçš„åŠ æ³•å­¦ä¹ è§„åˆ™ï¼Œæœ¬æ¨¡å‹ä½¿ç”¨æ›´ç¬¦åˆç”Ÿç‰©å­¦çš„ä¹˜æ³•å­¦ä¹ è§„åˆ™ï¼š

**åŒæ¶å­¦ä¹  (LTD)**:
```
w = w Ã— (1 - Î· Ã— R)
```
- æƒé‡æŒ‰æ¯”ä¾‹è¡°å‡
- æ¥è¿‘0æ—¶æ›´æ–°å¹…åº¦è‡ªç„¶å‡å°

**å¥–åŠ±å­¦ä¹  (LTP)**:
```
w = w + Î· Ã— |R| Ã— (1 - w)
```
- æƒé‡å‘1å¢é•¿
- æ¥è¿‘1æ—¶æ›´æ–°å¹…åº¦è‡ªç„¶å‡å°

**å‚æ•°è¯´æ˜**:
- **Î·**: å­¦ä¹ ç‡
- **R**: è°ƒåˆ¶ä¿¡å· (æ­£å€¼=åŒæ¶, è´Ÿå€¼=å¥–åŠ±)
- **w**: å½“å‰æƒé‡å€¼

### è¾¹ç•Œå‡é€Ÿç‰¹æ€§

ä¹˜æ³•è§„åˆ™çš„å…³é”®ä¼˜åŠ¿æ˜¯æƒé‡æ¥è¿‘è¾¹ç•Œ (0 æˆ– 1) æ—¶ï¼Œæ›´æ–°å¹…åº¦è‡ªç„¶å‡å°ï¼Œé¿å…æƒé‡å¿«é€Ÿé¥±å’Œã€‚

## è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯• (53ä¸ªæµ‹è¯•)
python -m pytest tests/ -v

# ä»…è¿è¡Œå±æ€§æµ‹è¯•
python -m pytest tests/test_properties.py -v

# ä»…è¿è¡Œé…ç½®æµ‹è¯•
python -m pytest tests/test_config.py -v

# ä»…è¿è¡Œè¯„ä¼°å™¨æµ‹è¯•
python -m pytest tests/test_evaluator.py -v
```

## API å‚è€ƒ

### DrosophilaOlfactoryModel

ä¸»æ¨¡å‹ç±»ï¼Œå®ç°å®Œæ•´çš„å—…è§‰ç³»ç»Ÿæ¨¡å‹ã€‚

| æ–¹æ³• | æè¿° |
|------|------|
| `from_config(config)` | ä» ModelConfig åˆ›å»ºæ¨¡å‹ |
| `predict(odor)` | é¢„æµ‹ MBON è¾“å‡ºå’Œ KC æ¿€æ´» |
| `modulate(kc_active, signal)` | åº”ç”¨è°ƒåˆ¶ä¿¡å·æ›´æ–°æƒé‡ (ä¹˜æ³•è§„åˆ™) |
| `train_aversive(odor, strength)` | æ‰§è¡ŒåŒæ¶å­¦ä¹  |
| `train_appetitive(odor, strength)` | æ‰§è¡Œå¥–åŠ±å­¦ä¹  |
| `reset_weights(clear_history)` | é‡ç½®æƒé‡ï¼Œå¯é€‰æ¸…é™¤å†å² |
| `get_learning_history()` | è·å–å­¦ä¹ å†å²è®°å½• |
| `to_json()` / `from_json()` | åºåˆ—åŒ–/ååºåˆ—åŒ– (å«ç§å­å’Œå†å²) |

### ModelConfig

é…ç½®ç®¡ç†æ•°æ®ç±»ã€‚

| å±æ€§ | é»˜è®¤å€¼ | æè¿° |
|------|--------|------|
| `n_pn` | 50 | æŠ•å°„ç¥ç»å…ƒæ•°é‡ |
| `n_kc` | 2000 | Kenyon ç»†èƒæ•°é‡ |
| `n_mbon` | 1 | è¾“å‡ºç¥ç»å…ƒæ•°é‡ |
| `sparsity` | 0.05 | KC å±‚ç¨€ç–åº¦ |
| `learning_rate` | 0.05 | å­¦ä¹ ç‡ |
| `connectivity` | 0.14 | PN-KC è¿æ¥ç‡ |
| `seed` | None | éšæœºç§å­ |

| æ–¹æ³• | æè¿° |
|------|------|
| `validate()` | éªŒè¯æ‰€æœ‰å‚æ•°æœ‰æ•ˆæ€§ |

### SparseEncoder

ç¨€ç–ç¼–ç å™¨ï¼Œå®ç° KC å±‚çš„ kWTA æœºåˆ¶ã€‚ä½¿ç”¨ç‹¬ç«‹çš„ `numpy.random.Generator`ã€‚

| æ–¹æ³• | æè¿° |
|------|------|
| `encode(input)` | æ‰§è¡Œç¨€ç–ç¼–ç  |
| `get_active_indices(input)` | è·å–æ¿€æ´»çš„ KC ç´¢å¼• |

### OdorDataset

æ°”å‘³æ•°æ®é›†ç”Ÿæˆå™¨ã€‚

| æ–¹æ³• | æè¿° |
|------|------|
| `generate_prototype(name)` | ç”Ÿæˆæ°”å‘³åŸå‹ |
| `generate_variants(proto, n, noise)` | ç”Ÿæˆå™ªå£°å˜ä½“ |
| `generate_concentration_variants(proto, factors)` | ç”Ÿæˆæµ“åº¦å˜ä½“ |
| `create_dataset(protos, n, noise)` | åˆ›å»ºå®Œæ•´æ•°æ®é›† |

### ModelEvaluator

æ¨¡å‹è¯„ä¼°å·¥å…·ï¼Œæ”¯æŒå¤š MBONã€‚

| æ–¹æ³• | æè¿° |
|------|------|
| `compute_discrimination_index(before, after, mbon_idx)` | è®¡ç®—æŒ‡å®š MBON çš„åŒºåˆ†æŒ‡æ•° |
| `compute_pattern_separation(odor_a, odor_b)` | è®¡ç®—æ¨¡å¼åˆ†ç¦»æ•ˆæœ |
| `evaluate_generalization(trained, variants)` | è¯„ä¼°æ³›åŒ–èƒ½åŠ› (è¿”å›æ‰€æœ‰ MBON) |
| `evaluate_specificity(trained, untrained)` | è¯„ä¼°å­¦ä¹ ç‰¹å¼‚æ€§ |

## è¾“å…¥éªŒè¯

æ¨¡å‹å¯¹è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯ï¼š

| æ£€æŸ¥é¡¹ | é”™è¯¯ç±»å‹ | è¯´æ˜ |
|--------|----------|------|
| ç±»å‹æ£€æŸ¥ | TypeError | è¾“å…¥å¿…é¡»æ˜¯ np.ndarray |
| ç»´åº¦æ£€æŸ¥ | ValueError | è¾“å…¥å¿…é¡»æ˜¯ä¸€ç»´æ•°ç»„ |
| å½¢çŠ¶æ£€æŸ¥ | ValueError | è¾“å…¥ç»´åº¦å¿…é¡»åŒ¹é… n_pn |
| NaN æ£€æŸ¥ | ValueError | è¾“å…¥ä¸èƒ½åŒ…å« NaN |
| Inf æ£€æŸ¥ | ValueError | è¾“å…¥ä¸èƒ½åŒ…å« Inf |

## è®¸å¯è¯

MIT License

## å‚è€ƒæ–‡çŒ®

- Aso, Y., & Rubin, G. M. (2016). Dopaminergic neurons write and update memories with cell-type-specific rules. eLife.
- Caron, S. J., et al. (2013). Random convergence of olfactory inputs in the Drosophila mushroom body. Nature.
- Turner, G. C., et al. (2008). Olfactory representations by Drosophila mushroom body neurons. Journal of Neurophysiology.
